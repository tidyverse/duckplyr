<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>A DuckDB-Backed Version of dplyr • duckplyr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet">
<link href="deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="A DuckDB-Backed Version of dplyr">
<meta name="description" content="A drop-in replacement for dplyr, powered by DuckDB for performance. Also defines a set of generics that provide a low-level implementers interface for the high-level user interface of dplyr'.">
<meta property="og:description" content="A drop-in replacement for dplyr, powered by DuckDB for performance. Also defines a set of generics that provide a low-level implementers interface for the high-level user interface of dplyr'.">
<meta property="og:image" content="https://duckplyr.tidyverse.org/logo.png">
<meta name="robots" content="noindex">
<script defer data-domain="duckplyr.tidyverse.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">duckplyr</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.4.1.9003</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidyverse/duckplyr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="duckplyr-">duckplyr 
<a class="anchor" aria-label="anchor" href="#duckplyr-"></a>
</h1>
</div>
<!-- badges: start -->

<p>The goal of the duckplyr R package is to provide a drop-in replacement for <a href="https://dplyr.tidyverse.org/" class="external-link">dplyr</a> that uses <a href="https://duckdb.org/" class="external-link">DuckDB</a> as a backend for fast operation. DuckDB is an in-process OLAP database management system, dplyr is the grammar of data manipulation in the tidyverse.</p>
<p>duckplyr also defines a set of generics that provide a low-level implementer’s interface for dplyr’s high-level user interface.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install duckplyr from CRAN with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"duckplyr"</span><span class="op">)</span></span></code></pre></div>
<p>You can also install the development version of duckplyr from R-universe:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"duckplyr"</span>, repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"https://tidyverse.r-universe.dev"</span>, <span class="st">"https://cloud.r-project.org"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Or from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak", repos = sprintf("https://r-lib.github.io/p/pak/stable/%s/%s/%s", .Platform$pkgType, R.Version()$os, R.Version()$arch))</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"tidyverse/duckplyr"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://conflicted.r-lib.org/" class="external-link">conflicted</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="fu">conflict_prefer</span><span class="op">(</span><span class="st">"filter"</span>, <span class="st">"dplyr"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">[conflicted]</span> Will prefer <span style="color: #0000BB; font-weight: bold;">dplyr</span>::filter over any</span></span>
<span><span class="co">#&gt; other package.</span></span></code></pre></div>
<p>There are two ways to use duckplyr.</p>
<ol style="list-style-type: decimal">
<li>To enable duckplyr for individual data frames, use <code><a href="reference/as_duckplyr_df.html">duckplyr::as_duckplyr_tibble()</a></code> as the first step in your pipe, without attaching the package.</li>
<li>By calling <code><a href="https://duckplyr.tidyverse.org">library(duckplyr)</a></code>, it overwrites dplyr methods and is automatically enabled for the entire session without having to call <code><a href="reference/as_duckplyr_df.html">as_duckplyr_tibble()</a></code>. To turn this off, call <code><a href="reference/methods_overwrite.html">methods_restore()</a></code>.</li>
</ol>
<p>The examples below illustrate both methods. See also the companion <a href="https://github.com/Tmonster/duckplyr_demo" class="external-link">demo repository</a> for a use case with a large dataset.</p>
<div class="section level3">
<h3 id="usage-for-individual-data-frames">Usage for individual data frames<a class="anchor" aria-label="anchor" href="#usage-for-individual-data-frames"></a>
</h3>
<p>This example illustrates usage of duckplyr for individual data frames.</p>
<p>Use <code><a href="reference/as_duckplyr_df.html">duckplyr::as_duckplyr_tibble()</a></code> to enable processing with duckdb:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">palmerpenguins</span><span class="fu">::</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/reference/penguins.html" class="external-link">penguins</a></span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># CAVEAT: factor columns are not supported yet</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html" class="external-link">where</a></span><span class="op">(</span><span class="va">is.factor</span><span class="op">)</span>, <span class="va">as.character</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">duckplyr</span><span class="fu">::</span><span class="fu"><a href="reference/as_duckplyr_df.html">as_duckplyr_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>bill_area <span class="op">=</span> <span class="va">bill_length_mm</span> <span class="op">*</span> <span class="va">bill_depth_mm</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">sex</span><span class="op">)</span>, mean_bill_area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">bill_area</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">!=</span> <span class="st">"Gentoo"</span><span class="op">)</span></span></code></pre></div>
<p>The result is a tibble, with its own class.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "duckplyr_df" "tbl_df"      "tbl"         "data.frame"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "species"        "sex"            "mean_bill_area"</span></span></code></pre></div>
<p>duckdb is responsible for eventually carrying out the operations. Despite the late filter, the summary is not computed for the Gentoo species.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/explain.html" class="external-link">explain</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ┌---------------------------┐</span></span>
<span><span class="co">#&gt; │          ORDER_BY         │</span></span>
<span><span class="co">#&gt; │    --------------------   │</span></span>
<span><span class="co">#&gt; │      dataframe_42_42      │</span></span>
<span><span class="co">#&gt; │    42.___row_number ASC   │</span></span>
<span><span class="co">#&gt; └-------------┬-------------┘</span></span>
<span><span class="co">#&gt; ┌-------------┴-------------┐</span></span>
<span><span class="co">#&gt; │           FILTER          │</span></span>
<span><span class="co">#&gt; │    --------------------   │</span></span>
<span><span class="co">#&gt; │   "r_base::!="(species,   │</span></span>
<span><span class="co">#&gt; │         'Gentoo')         │</span></span>
<span><span class="co">#&gt; │                           │</span></span>
<span><span class="co">#&gt; │          ~34 Rows         │</span></span>
<span><span class="co">#&gt; └-------------┬-------------┘</span></span>
<span><span class="co">#&gt; ┌-------------┴-------------┐</span></span>
<span><span class="co">#&gt; │         PROJECTION        │</span></span>
<span><span class="co">#&gt; │    --------------------   │</span></span>
<span><span class="co">#&gt; │             #0            │</span></span>
<span><span class="co">#&gt; │             #1            │</span></span>
<span><span class="co">#&gt; │             #2            │</span></span>
<span><span class="co">#&gt; │             #3            │</span></span>
<span><span class="co">#&gt; │                           │</span></span>
<span><span class="co">#&gt; │         ~172 Rows         │</span></span>
<span><span class="co">#&gt; └-------------┬-------------┘</span></span>
<span><span class="co">#&gt; ┌-------------┴-------------┐</span></span>
<span><span class="co">#&gt; │      STREAMING_WINDOW     │</span></span>
<span><span class="co">#&gt; │    --------------------   │</span></span>
<span><span class="co">#&gt; │        Projections:       │</span></span>
<span><span class="co">#&gt; │    ROW_NUMBER() OVER ()   │</span></span>
<span><span class="co">#&gt; └-------------┬-------------┘</span></span>
<span><span class="co">#&gt; ┌-------------┴-------------┐</span></span>
<span><span class="co">#&gt; │          ORDER_BY         │</span></span>
<span><span class="co">#&gt; │    --------------------   │</span></span>
<span><span class="co">#&gt; │      dataframe_42_42      │</span></span>
<span><span class="co">#&gt; │    42.___row_number ASC   │</span></span>
<span><span class="co">#&gt; └-------------┬-------------┘</span></span>
<span><span class="co">#&gt; ┌-------------┴-------------┐</span></span>
<span><span class="co">#&gt; │       HASH_GROUP_BY       │</span></span>
<span><span class="co">#&gt; │    --------------------   │</span></span>
<span><span class="co">#&gt; │          Groups:          │</span></span>
<span><span class="co">#&gt; │             #0            │</span></span>
<span><span class="co">#&gt; │             #1            │</span></span>
<span><span class="co">#&gt; │                           │</span></span>
<span><span class="co">#&gt; │        Aggregates:        │</span></span>
<span><span class="co">#&gt; │          min(#2)          │</span></span>
<span><span class="co">#&gt; │          mean(#3)         │</span></span>
<span><span class="co">#&gt; │                           │</span></span>
<span><span class="co">#&gt; │         ~172 Rows         │</span></span>
<span><span class="co">#&gt; └-------------┬-------------┘</span></span>
<span><span class="co">#&gt; ┌-------------┴-------------┐</span></span>
<span><span class="co">#&gt; │         PROJECTION        │</span></span>
<span><span class="co">#&gt; │    --------------------   │</span></span>
<span><span class="co">#&gt; │          species          │</span></span>
<span><span class="co">#&gt; │            sex            │</span></span>
<span><span class="co">#&gt; │       ___row_number       │</span></span>
<span><span class="co">#&gt; │         bill_area         │</span></span>
<span><span class="co">#&gt; │                           │</span></span>
<span><span class="co">#&gt; │         ~344 Rows         │</span></span>
<span><span class="co">#&gt; └-------------┬-------------┘</span></span>
<span><span class="co">#&gt; ┌-------------┴-------------┐</span></span>
<span><span class="co">#&gt; │         PROJECTION        │</span></span>
<span><span class="co">#&gt; │    --------------------   │</span></span>
<span><span class="co">#&gt; │             #0            │</span></span>
<span><span class="co">#&gt; │             #1            │</span></span>
<span><span class="co">#&gt; │             #2            │</span></span>
<span><span class="co">#&gt; │             #3            │</span></span>
<span><span class="co">#&gt; │                           │</span></span>
<span><span class="co">#&gt; │         ~344 Rows         │</span></span>
<span><span class="co">#&gt; └-------------┬-------------┘</span></span>
<span><span class="co">#&gt; ┌-------------┴-------------┐</span></span>
<span><span class="co">#&gt; │      STREAMING_WINDOW     │</span></span>
<span><span class="co">#&gt; │    --------------------   │</span></span>
<span><span class="co">#&gt; │        Projections:       │</span></span>
<span><span class="co">#&gt; │    ROW_NUMBER() OVER ()   │</span></span>
<span><span class="co">#&gt; └-------------┬-------------┘</span></span>
<span><span class="co">#&gt; ┌-------------┴-------------┐</span></span>
<span><span class="co">#&gt; │         PROJECTION        │</span></span>
<span><span class="co">#&gt; │    --------------------   │</span></span>
<span><span class="co">#&gt; │          species          │</span></span>
<span><span class="co">#&gt; │            sex            │</span></span>
<span><span class="co">#&gt; │         bill_area         │</span></span>
<span><span class="co">#&gt; │                           │</span></span>
<span><span class="co">#&gt; │         ~344 Rows         │</span></span>
<span><span class="co">#&gt; └-------------┬-------------┘</span></span>
<span><span class="co">#&gt; ┌-------------┴-------------┐</span></span>
<span><span class="co">#&gt; │     R_DATAFRAME_SCAN      │</span></span>
<span><span class="co">#&gt; │    --------------------   │</span></span>
<span><span class="co">#&gt; │         data.frame        │</span></span>
<span><span class="co">#&gt; │                           │</span></span>
<span><span class="co">#&gt; │        Projections:       │</span></span>
<span><span class="co">#&gt; │          species          │</span></span>
<span><span class="co">#&gt; │       bill_length_mm      │</span></span>
<span><span class="co">#&gt; │       bill_depth_mm       │</span></span>
<span><span class="co">#&gt; │            sex            │</span></span>
<span><span class="co">#&gt; │                           │</span></span>
<span><span class="co">#&gt; │         ~344 Rows         │</span></span>
<span><span class="co">#&gt; └---------------------------┘</span></span></code></pre></div>
<p>All data frame operations are supported. Computation happens upon the first request.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span><span class="op">$</span><span class="va">mean_bill_area</span></span>
<span><span class="co">#&gt; materializing:</span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; --- Relation Tree ---</span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; Projection [species as species, sex as sex, mean_bill_area as mean_bill_area]</span></span>
<span><span class="co">#&gt;   Order [___row_number ASC]</span></span>
<span><span class="co">#&gt;     Filter ["!="(species, 'Gentoo')]</span></span>
<span><span class="co">#&gt;       Projection [species as species, sex as sex, mean_bill_area as mean_bill_area, row_number() OVER () as ___row_number]</span></span>
<span><span class="co">#&gt;         Projection [species as species, sex as sex, mean_bill_area as mean_bill_area]</span></span>
<span><span class="co">#&gt;           Order [___row_number ASC]</span></span>
<span><span class="co">#&gt;             Aggregate [species, sex, min(___row_number), mean(bill_area)]</span></span>
<span><span class="co">#&gt;               Projection [species as species, island as island, bill_length_mm as bill_length_mm, bill_depth_mm as bill_depth_mm, flipper_length_mm as flipper_length_mm, body_mass_g as body_mass_g, sex as sex, "year" as year, bill_area as bill_area, row_number() OVER () as ___row_number]</span></span>
<span><span class="co">#&gt;                 Projection [species as species, island as island, bill_length_mm as bill_length_mm, bill_depth_mm as bill_depth_mm, flipper_length_mm as flipper_length_mm, body_mass_g as body_mass_g, sex as sex, "year" as year, "*"(bill_length_mm, bill_depth_mm) as bill_area]</span></span>
<span><span class="co">#&gt;                   r_dataframe_scan(0xdeadbeef)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; -- Result Columns  --</span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; - species (VARCHAR)</span></span>
<span><span class="co">#&gt; - sex (VARCHAR)</span></span>
<span><span class="co">#&gt; - mean_bill_area (DOUBLE)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [1] 770.2627 656.8523 694.9360 819.7503 984.2279</span></span></code></pre></div>
<p>After the computation has been carried out, the results are available immediately:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 3</span></span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">species</span>   <span style="font-weight: bold;">sex</span>    <span style="font-weight: bold;">mean_bill_area</span></span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Adelie    male             770.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Adelie    female           657.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Adelie    <span style="color: #BB0000;">NA</span>               695.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Chinstrap female           820.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Chinstrap male             984.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="session-wide-usage">Session-wide usage<a class="anchor" aria-label="anchor" href="#session-wide-usage"></a>
</h3>
<p>This example illustrates usage of duckplyr for all data frames in the R session.</p>
<p>Use <code><a href="https://duckplyr.tidyverse.org">library(duckplyr)</a></code> or <code><a href="reference/methods_overwrite.html">duckplyr::methods_overwrite()</a></code> to overwrite dplyr methods and enable processing with duckdb for all data frames:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">duckplyr</span><span class="fu">::</span><span class="fu"><a href="reference/methods_overwrite.html">methods_overwrite</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Overwriting <span style="color: #0000BB;">dplyr</span> methods with <span style="color: #0000BB;">duckplyr</span> methods.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Turn off with `duckplyr::methods_restore()`.</span></span></code></pre></div>
<p>This is the same query as above, without <code><a href="reference/as_duckplyr_df.html">as_duckplyr_tibble()</a></code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">palmerpenguins</span><span class="fu">::</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/reference/penguins.html" class="external-link">penguins</a></span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># CAVEAT: factor columns are not supported yet</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html" class="external-link">where</a></span><span class="op">(</span><span class="va">is.factor</span><span class="op">)</span>, <span class="va">as.character</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>bill_area <span class="op">=</span> <span class="va">bill_length_mm</span> <span class="op">*</span> <span class="va">bill_depth_mm</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">sex</span><span class="op">)</span>, mean_bill_area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">bill_area</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">!=</span> <span class="st">"Gentoo"</span><span class="op">)</span></span></code></pre></div>
<p>The result is a plain tibble now:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "tbl_df"     "tbl"        "data.frame"</span></span></code></pre></div>
<p>Querying the number of rows also starts the computation:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="co">#&gt; materializing:</span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; --- Relation Tree ---</span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; Projection [species as species, sex as sex, mean_bill_area as mean_bill_area]</span></span>
<span><span class="co">#&gt;   Order [___row_number ASC]</span></span>
<span><span class="co">#&gt;     Filter ["!="(species, 'Gentoo')]</span></span>
<span><span class="co">#&gt;       Projection [species as species, sex as sex, mean_bill_area as mean_bill_area, row_number() OVER () as ___row_number]</span></span>
<span><span class="co">#&gt;         Projection [species as species, sex as sex, mean_bill_area as mean_bill_area]</span></span>
<span><span class="co">#&gt;           Order [___row_number ASC]</span></span>
<span><span class="co">#&gt;             Aggregate [species, sex, min(___row_number), mean(bill_area)]</span></span>
<span><span class="co">#&gt;               Projection [species as species, island as island, bill_length_mm as bill_length_mm, bill_depth_mm as bill_depth_mm, flipper_length_mm as flipper_length_mm, body_mass_g as body_mass_g, sex as sex, "year" as year, bill_area as bill_area, row_number() OVER () as ___row_number]</span></span>
<span><span class="co">#&gt;                 Projection [species as species, island as island, bill_length_mm as bill_length_mm, bill_depth_mm as bill_depth_mm, flipper_length_mm as flipper_length_mm, body_mass_g as body_mass_g, sex as sex, "year" as year, "*"(bill_length_mm, bill_depth_mm) as bill_area]</span></span>
<span><span class="co">#&gt;                   r_dataframe_scan(0xdeadbeef)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; -- Result Columns  --</span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; - species (VARCHAR)</span></span>
<span><span class="co">#&gt; - sex (VARCHAR)</span></span>
<span><span class="co">#&gt; - mean_bill_area (DOUBLE)</span></span>
<span><span class="co">#&gt; [1] 5</span></span></code></pre></div>
<p>Restart R, or call <code><a href="reference/methods_overwrite.html">duckplyr::methods_restore()</a></code> to revert to the default dplyr implementation.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">duckplyr</span><span class="fu">::</span><span class="fu"><a href="reference/methods_overwrite.html">methods_restore</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Restoring <span style="color: #0000BB;">dplyr</span> methods.</span></span></code></pre></div>
<p>dplyr is active again:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">palmerpenguins</span><span class="fu">::</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/reference/penguins.html" class="external-link">penguins</a></span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># CAVEAT: factor columns are not supported yet</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html" class="external-link">where</a></span><span class="op">(</span><span class="va">is.factor</span><span class="op">)</span>, <span class="va">as.character</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>bill_area <span class="op">=</span> <span class="va">bill_length_mm</span> <span class="op">*</span> <span class="va">bill_depth_mm</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">sex</span><span class="op">)</span>, mean_bill_area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">bill_area</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">!=</span> <span class="st">"Gentoo"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 3</span></span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">species</span>   <span style="font-weight: bold;">sex</span>    <span style="font-weight: bold;">mean_bill_area</span></span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Adelie    male             770.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Adelie    female           657.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Adelie    <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Chinstrap female           820.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Chinstrap male             984.</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="telemetry">Telemetry<a class="anchor" aria-label="anchor" href="#telemetry"></a>
</h2>
<p>We would like to guide our efforts towards improving duckplyr, focusing on the features with the most impact. To this end, duckplyr collects and uploads telemetry data, but only if permitted by the user:</p>
<ul>
<li>No collection will happen unless the user explicitly opts in.</li>
<li>Uploads are done upon request only.</li>
<li>There is an option to automatically upload when the package is loaded, this is also opt-in.</li>
</ul>
<p>The data collected contains:</p>
<ul>
<li>The package version</li>
<li>The error message</li>
<li>The operation being performed, and the arguments
<ul>
<li>For the input data frames, only the structure is included (column types only), no column names or data</li>
</ul>
</li>
</ul>
<p>The first time the package encounters an unsupported function, data type, or operation, instructions are printed to the console.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">palmerpenguins</span><span class="fu">::</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/reference/penguins.html" class="external-link">penguins</a></span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">duckplyr</span><span class="fu">::</span><span class="fu"><a href="reference/as_duckplyr_df.html">as_duckplyr_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span>bill_area <span class="op">=</span> <span class="va">bill_length_mm</span> <span class="op">*</span> <span class="va">bill_depth_mm</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; The <span style="color: #0000BB;">duckplyr</span> package is configured to fall back to <span style="color: #0000BB;">dplyr</span> when it encounters an</span></span>
<span><span class="co">#&gt; incompatibility. Fallback events can be collected and uploaded for analysis to</span></span>
<span><span class="co">#&gt; guide future development. By default, no data will be collected or uploaded.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> A fallback situation just occurred. The following information would have been</span></span>
<span><span class="co">#&gt;   recorded:</span></span>
<span><span class="co">#&gt;   {"version":"0.4.1","message":"Can't convert columns of class &lt;factor&gt; to</span></span>
<span><span class="co">#&gt;   relational. Affected</span></span>
<span><span class="co">#&gt;   column:\n`...1`.","name":"transmute","x":{"...1":"factor","...2":"factor","...3":"numeric","...4":"numeric","...5":"integer","...6":"integer","...7":"factor","...8":"integer"},"args":{"dots":{"...9":"...3</span></span>
<span><span class="co">#&gt;   * ...4"}}}</span></span>
<span><span class="co">#&gt; → Run `duckplyr::fallback_sitrep()` to review the current settings.</span></span>
<span><span class="co">#&gt; → Run `Sys.setenv(DUCKPLYR_FALLBACK_COLLECT = 1)` to enable fallback logging,</span></span>
<span><span class="co">#&gt;   and `Sys.setenv(DUCKPLYR_FALLBACK_VERBOSE = TRUE)` in addition to enable</span></span>
<span><span class="co">#&gt;   printing of fallback situations to the console.</span></span>
<span><span class="co">#&gt; → Run `duckplyr::fallback_review()` to review the available reports, and</span></span>
<span><span class="co">#&gt;   `duckplyr::fallback_upload()` to upload them.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See `?duckplyr::fallback()` for details.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #555555;">This message will be displayed once every eight hours.</span></span></span>
<span><span class="co">#&gt; materializing:</span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; --- Relation Tree ---</span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; Limit 3</span></span>
<span><span class="co">#&gt;   r_dataframe_scan(0xdeadbeef)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; -- Result Columns  --</span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; - bill_area (DOUBLE)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 1</span></span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">bill_area</span></span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      731.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>      687.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>      725.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="how-is-this-different-from-dbplyr">How is this different from dbplyr?<a class="anchor" aria-label="anchor" href="#how-is-this-different-from-dbplyr"></a>
</h2>
<p>The duckplyr package is a dplyr backend that uses DuckDB, a high-performance, embeddable OLAP database. It is designed to be a fully compatible drop-in replacement for dplyr, with <em>exactly</em> the same syntax and semantics:</p>
<ul>
<li>Input and output are data frames or tibbles</li>
<li>All dplyr verbs are supported, with fallback</li>
<li>All R data types and functions are supported, with fallback</li>
<li>No SQL is generated</li>
</ul>
<p>The dbplyr package is a dplyr backend that connects to SQL databases, and is designed to work with various databases that support SQL, including DuckDB. Data must be copied into and collected from the database, and the syntax and semantics are similar but not identical to plain dplyr.</p>
</div>
<div class="section level2">
<h2 id="extensibility">Extensibility<a class="anchor" aria-label="anchor" href="#extensibility"></a>
</h2>
<p>This package also provides generics, for which other packages may then implement methods.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://duckplyr.tidyverse.org">duckplyr</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Overwriting <span style="color: #0000BB;">dplyr</span> methods with <span style="color: #0000BB;">duckplyr</span> methods.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Turn off with `duckplyr::methods_restore()`.</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a relational to be used by examples below</span></span>
<span><span class="va">new_dfrel</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">is.data.frame</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="reference/new_relational.html">new_relational</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"dfrel"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">mtcars_rel</span> <span class="op">&lt;-</span> <span class="fu">new_dfrel</span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Example 1: return a data.frame</span></span>
<span><span class="va">rel_to_df.dfrel</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rel</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="va">rel</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="reference/new_relational.html">rel_to_df</a></span><span class="op">(</span><span class="va">mtcars_rel</span><span class="op">)</span></span>
<span><span class="co">#&gt;                    mpg cyl disp  hp</span></span>
<span><span class="co">#&gt; Mazda RX4         21.0   6  160 110</span></span>
<span><span class="co">#&gt; Mazda RX4 Wag     21.0   6  160 110</span></span>
<span><span class="co">#&gt; Datsun 710        22.8   4  108  93</span></span>
<span><span class="co">#&gt; Hornet 4 Drive    21.4   6  258 110</span></span>
<span><span class="co">#&gt; Hornet Sportabout 18.7   8  360 175</span></span>
<span></span>
<span><span class="co"># Example 2: A (random) filter</span></span>
<span><span class="va">rel_filter.dfrel</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rel</span>, <span class="va">exprs</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="va">rel</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>  <span class="co"># A real implementation would evaluate the predicates defined</span></span>
<span>  <span class="co"># by the exprs argument</span></span>
<span>  <span class="fu">new_dfrel</span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, <span class="fl">3</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="reference/new_relational.html">rel_filter</a></span><span class="op">(</span></span>
<span>  <span class="va">mtcars_rel</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="reference/new_relexpr.html">relexpr_function</a></span><span class="op">(</span></span>
<span>      <span class="st">"gt"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="reference/new_relexpr.html">relexpr_reference</a></span><span class="op">(</span><span class="st">"cyl"</span><span class="op">)</span>, <span class="fu"><a href="reference/new_relexpr.html">relexpr_constant</a></span><span class="op">(</span><span class="st">"6"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;                  mpg cyl disp  hp</span></span>
<span><span class="co">#&gt; Mazda RX4 Wag   21.0   6  160 110</span></span>
<span><span class="co">#&gt; Mazda RX4 Wag.1 21.0   6  160 110</span></span>
<span><span class="co">#&gt; Datsun 710      22.8   4  108  93</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "dfrel"      "relational"</span></span>
<span></span>
<span><span class="co"># Example 3: A custom projection</span></span>
<span><span class="va">rel_project.dfrel</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rel</span>, <span class="va">exprs</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="va">rel</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>  <span class="co"># A real implementation would evaluate the expressions defined</span></span>
<span>  <span class="co"># by the exprs argument</span></span>
<span>  <span class="fu">new_dfrel</span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="reference/new_relational.html">rel_project</a></span><span class="op">(</span></span>
<span>  <span class="va">mtcars_rel</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="reference/new_relexpr.html">relexpr_reference</a></span><span class="op">(</span><span class="st">"cyl"</span><span class="op">)</span>, <span class="fu"><a href="reference/new_relexpr.html">relexpr_reference</a></span><span class="op">(</span><span class="st">"disp"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;                    mpg cyl disp</span></span>
<span><span class="co">#&gt; Mazda RX4         21.0   6  160</span></span>
<span><span class="co">#&gt; Mazda RX4 Wag     21.0   6  160</span></span>
<span><span class="co">#&gt; Datsun 710        22.8   4  108</span></span>
<span><span class="co">#&gt; Hornet 4 Drive    21.4   6  258</span></span>
<span><span class="co">#&gt; Hornet Sportabout 18.7   8  360</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "dfrel"      "relational"</span></span>
<span></span>
<span><span class="co"># Example 4: A custom ordering (eg, ascending by mpg)</span></span>
<span><span class="va">rel_order.dfrel</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rel</span>, <span class="va">exprs</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="va">rel</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>  <span class="co"># A real implementation would evaluate the expressions defined</span></span>
<span>  <span class="co"># by the exprs argument</span></span>
<span>  <span class="fu">new_dfrel</span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">df</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="reference/new_relational.html">rel_order</a></span><span class="op">(</span></span>
<span>  <span class="va">mtcars_rel</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="reference/new_relexpr.html">relexpr_reference</a></span><span class="op">(</span><span class="st">"mpg"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;                    mpg cyl disp  hp</span></span>
<span><span class="co">#&gt; Hornet Sportabout 18.7   8  360 175</span></span>
<span><span class="co">#&gt; Mazda RX4         21.0   6  160 110</span></span>
<span><span class="co">#&gt; Mazda RX4 Wag     21.0   6  160 110</span></span>
<span><span class="co">#&gt; Hornet 4 Drive    21.4   6  258 110</span></span>
<span><span class="co">#&gt; Datsun 710        22.8   4  108  93</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "dfrel"      "relational"</span></span>
<span></span>
<span><span class="co"># Example 5: A custom join</span></span>
<span><span class="va">rel_join.dfrel</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">left</span>, <span class="va">right</span>, <span class="va">conds</span>, <span class="va">join</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">left_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="va">left</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">right_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="va">right</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>  <span class="co"># A real implementation would evaluate the expressions</span></span>
<span>  <span class="co"># defined by the conds argument,</span></span>
<span>  <span class="co"># use different join types based on the join argument,</span></span>
<span>  <span class="co"># and implement the join itself instead of relaying to left_join().</span></span>
<span>  <span class="fu">new_dfrel</span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">left_df</span>, <span class="va">right_df</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="reference/new_relational.html">rel_join</a></span><span class="op">(</span><span class="fu">new_dfrel</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>mpg <span class="op">=</span> <span class="fl">21</span><span class="op">)</span><span class="op">)</span>, <span class="va">mtcars_rel</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(mpg)`</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(mpg)`</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;   mpg cyl disp  hp</span></span>
<span><span class="co">#&gt; 1  21   6  160 110</span></span>
<span><span class="co">#&gt; 2  21   6  160 110</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "dfrel"      "relational"</span></span>
<span></span>
<span><span class="co"># Example 6: Limit the maximum rows returned</span></span>
<span><span class="va">rel_limit.dfrel</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rel</span>, <span class="va">n</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="va">rel</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>  <span class="fu">new_dfrel</span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="reference/new_relational.html">rel_limit</a></span><span class="op">(</span><span class="va">mtcars_rel</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;                mpg cyl disp  hp</span></span>
<span><span class="co">#&gt; Mazda RX4     21.0   6  160 110</span></span>
<span><span class="co">#&gt; Mazda RX4 Wag 21.0   6  160 110</span></span>
<span><span class="co">#&gt; Datsun 710    22.8   4  108  93</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "dfrel"      "relational"</span></span>
<span></span>
<span><span class="co"># Example 7: Suppress duplicate rows</span></span>
<span><span class="co">#  (ignoring row names)</span></span>
<span><span class="va">rel_distinct.dfrel</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rel</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="va">rel</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>  <span class="fu">new_dfrel</span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="reference/new_relational.html">rel_distinct</a></span><span class="op">(</span><span class="fu">new_dfrel</span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;             mpg cyl disp  hp</span></span>
<span><span class="co">#&gt; Mazda RX4  21.0   6  160 110</span></span>
<span><span class="co">#&gt; Datsun 710 22.8   4  108  93</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "dfrel"      "relational"</span></span>
<span></span>
<span><span class="co"># Example 8: Return column names</span></span>
<span><span class="va">rel_names.dfrel</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rel</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="va">rel</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="reference/new_relational.html">rel_names</a></span><span class="op">(</span><span class="va">mtcars_rel</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "mpg"  "cyl"  "disp" "hp"</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=duckplyr" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/tidyverse/duckplyr/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/tidyverse/duckplyr/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing duckplyr</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://hannes.muehleisen.org/" class="external-link">Hannes Mühleisen</a> <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0001-8552-0029" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>
<a href="https://krlmlr.info" class="external-link">Kirill Müller</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-1416-3412" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>
<a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a> <br><small class="roles"> Copyright holder, funder </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://github.com/tidyverse/duckplyr/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/tidyverse/duckplyr/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://hannes.muehleisen.org/" class="external-link">Hannes Mühleisen</a>, <a href="https://krlmlr.info" class="external-link">Kirill Müller</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

  </div></footer>
</body>
</html>
