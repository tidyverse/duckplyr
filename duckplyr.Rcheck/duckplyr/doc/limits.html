<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Translations</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Translations</h1>



<p>This article describes the translations provided by duckplyr for
different data types, verbs, and functions within verbs. If a
translation is not provided, duckplyr falls back to dplyr, see
<code>vignette(&quot;fallback&quot;)</code> for details. The translation layer can
be bypassed, see <code>vignette(&quot;duckdb&quot;)</code> for details.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(conflicted)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">conflict_prefer</span>(<span class="st">&quot;filter&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">#&gt; [conflicted] Removing existing preference.</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co">#&gt; [conflicted] Will prefer dplyr::filter over any other package.</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">conflict_prefer</span>(<span class="st">&quot;lag&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co">#&gt; [conflicted] Will prefer dplyr::lag over any other package.</span></span></code></pre></div>
<div id="data-types" class="section level2">
<h2>Data types</h2>
<p>duckplyr supports the following data types:</p>
<ul>
<li><code>is.logical()</code></li>
<li><code>is.integer()</code></li>
<li><code>is.numeric()</code></li>
<li><code>is.character()</code></li>
<li><code>is.Date()</code></li>
<li><code>is.POSIXct()</code> (with UTC time zone)</li>
<li><code>is.difftime()</code></li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  <span class="at">logical =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="at">integer =</span> <span class="dv">1</span><span class="dt">L</span>,</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  <span class="at">numeric =</span> <span class="fl">1.1</span>,</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  <span class="at">character =</span> <span class="st">&quot;a&quot;</span>,</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  <span class="at">Date =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2025-01-11&quot;</span>),</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>  <span class="at">POSIXct =</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;2025-01-11 19:23:00&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;UTC&quot;</span>),</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>  <span class="at">difftime =</span> <span class="fu">as.difftime</span>(<span class="dv">1</span>, <span class="at">units =</span> <span class="st">&quot;secs&quot;</span>),</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>  <span class="fu">compute</span>()</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co">#&gt; # A duckplyr data frame: 7 variables</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="co">#&gt;   logical integer numeric character Date       POSIXct             difftime</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co">#&gt;   &lt;lgl&gt;     &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;date&gt;     &lt;dttm&gt;              &lt;drtn&gt;  </span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="co">#&gt; 1 TRUE          1     1.1 a         2025-01-11 2025-01-11 19:23:00 1 secs</span></span></code></pre></div>
<p>Generally, zero-column tibbles are not supported by duckplyr, neither
as input nor as a result.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>()</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co">#&gt; Error in `duckplyr::duckdb_tibble()`:</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#&gt; ! Can&#39;t convert empty data frame to relational.</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">.prudence =</span> <span class="st">&quot;stingy&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>a)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">#&gt; Error in `select()`:</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">#&gt; ! This operation cannot be carried out by DuckDB, and the input is a</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">#&gt;   stingy duckplyr frame.</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#&gt; • Zero-column result set not supported.</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt; ℹ Use `compute(prudence = &quot;lavish&quot;)` to materialize to temporary storage and</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt;   continue with duckplyr.</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">#&gt; ℹ See `vignette(&quot;prudence&quot;)` for other options.</span></span></code></pre></div>
<p>Support for more data types, and passthrough of unknown data types,
is planned. Let’s <a href="https://github.com/tidyverse/duckplyr/discussions/">discuss</a>
any additional data types you would like to see supported.</p>
</div>
<div id="verbs" class="section level2">
<h2>Verbs</h2>
<p>Not all dplyr verbs are implemented within duckplyr. For unsupported
verbs, duckplyr automatically falls back to dplyr. See
<code>?unsupported</code> for a list of verbs for which duckplyr does
not provide a method.</p>
<p>See the <a href="https://duckplyr.tidyverse.org/reference/index.html">reference
index</a> for a list of verbs with corresponding duckplyr methods.</p>
<p>Let’s <a href="https://github.com/tidyverse/duckplyr/discussions/">discuss</a>
any additional verbs you would like to see supported.</p>
</div>
<div id="functions-within-verbs" class="section level2">
<h2>Functions within verbs</h2>
<p>For all functions used in dplyr verbs, translations must be provided.
If an expression contains a function for which no translation is
provided, duckplyr falls back to dplyr. With some exceptions, only
positional matching is implemented.</p>
<p>As of now, here are the translations provided:</p>
<div id="parentheses" class="section level3">
<h3>Parentheses</h3>
<p>Implemented: <code>(</code>.</p>
<p>Reference: <code>?Paren</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>, <span class="at">c =</span> <span class="dv">3</span>, <span class="at">.prudence =</span> <span class="st">&quot;stingy&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  <span class="fu">mutate</span>((a <span class="sc">+</span> b) <span class="sc">*</span> c)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co">#&gt; # A duckplyr data frame: 4 variables</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co">#&gt;       a     b     c `(a + b) * c`</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#&gt; 1     1     2     3             9</span></span></code></pre></div>
</div>
<div id="comparison-operators" class="section level3">
<h3>Comparison operators</h3>
<p>Implemented: <code>&gt;</code>, <code>&gt;=</code>,
<code>&lt;</code>, <code>&lt;=</code>, <code>==</code>,
<code>!=</code>.</p>
<p>Reference: <code>?Comparison</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="at">a =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="cn">NA</span>),</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="at">b =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="cn">NA</span>, <span class="dv">3</span>),</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  <span class="at">c =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  <span class="at">.prudence =</span> <span class="st">&quot;stingy&quot;</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  <span class="fu">mutate</span>(a <span class="sc">&gt;</span> b, b <span class="sc">!=</span> c, c <span class="sc">&lt;</span> a, a <span class="sc">&gt;=</span> b, b <span class="sc">&lt;=</span> c)</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt; # A duckplyr data frame: 8 variables</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt;       a     b     c `a &gt; b` `b != c` `c &lt; a` `a &gt;= b` `b &lt;= c`</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt;   &lt;lgl&gt;    &lt;lgl&gt;   &lt;lgl&gt;    &lt;lgl&gt;   </span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">#&gt; 1     1     2    NA FALSE   NA       NA      FALSE    NA      </span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">#&gt; 2     2    NA     3 NA      NA       FALSE   NA       NA      </span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">#&gt; 3    NA     3     4 NA      TRUE     NA      NA       TRUE</span></span></code></pre></div>
</div>
<div id="basic-arithmetics" class="section level3">
<h3>Basic arithmetics</h3>
<p>Implemented: <code>+</code>, <code>-</code>, <code>*</code>,
<code>/</code>.</p>
<p>Reference: <code>?Arithmetic</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>, <span class="at">c =</span> <span class="dv">3</span>, <span class="at">.prudence =</span> <span class="st">&quot;stingy&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="fu">mutate</span>(a <span class="sc">+</span> b, a <span class="sc">/</span> b, a <span class="sc">-</span> b, a <span class="sc">*</span> b)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#&gt; # A duckplyr data frame: 7 variables</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#&gt;       a     b     c `a + b` `a/b` `a - b` `a * b`</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt; 1     1     2     3       3   0.5      -1       2</span></span></code></pre></div>
</div>
<div id="math-functions" class="section level3">
<h3>Math functions</h3>
<p>Implemented: <code>log()</code>, <code>log10()</code>,
<code>abs()</code>.</p>
<p>Reference: <code>?Math</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>, <span class="at">c =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">.prudence =</span> <span class="st">&quot;stingy&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">log10</span>(a), <span class="fu">log</span>(b), <span class="fu">abs</span>(c))</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co">#&gt; # A duckplyr data frame: 6 variables</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co">#&gt;       a     b     c `log10(a)` `log(b)` `abs(c)`</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt; 1     1     2    -3          0    0.693        3</span></span></code></pre></div>
</div>
<div id="logical-operators" class="section level3">
<h3>Logical operators</h3>
<p>Implemented: <code>!</code>, <code>&amp;</code>, <code>|</code>.</p>
<p>Reference: <code>?Logic</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(<span class="at">a =</span> <span class="cn">FALSE</span>, <span class="at">b =</span> <span class="cn">TRUE</span>, <span class="at">c =</span> <span class="cn">NA</span>, <span class="at">.prudence =</span> <span class="st">&quot;stingy&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="sc">!</span>a, a <span class="sc">&amp;</span> b, b <span class="sc">|</span> c)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co">#&gt; # A duckplyr data frame: 6 variables</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co">#&gt;   a     b     c     `!a`  `a &amp; b` `b | c`</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt;   &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt;   &lt;lgl&gt;  </span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt; 1 FALSE TRUE  NA    TRUE  FALSE   TRUE</span></span></code></pre></div>
</div>
<div id="branching-and-conversion" class="section level3">
<h3>Branching and conversion</h3>
<p>Implemented:</p>
<ul>
<li><code>is.na()</code>, <code>as.integer()</code></li>
<li><code>dplyr::if_else()</code>, <code>dplyr::coalesce()</code></li>
<li><code>strftime(x, format)</code></li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="cn">NA</span>, <span class="at">.prudence =</span> <span class="st">&quot;stingy&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">is.na</span>(b), <span class="fu">if_else</span>(<span class="fu">is.na</span>(b), <span class="dv">0</span>, <span class="dv">1</span>), <span class="fu">as.integer</span>(b))</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co">#&gt; # A duckplyr data frame: 5 variables</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co">#&gt;       a b     `is.na(b)` `if_else(is.na(b), 0, 1)` `as.integer(b)`</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt;                          &lt;dbl&gt;           &lt;int&gt;</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#&gt; 1     1 NA    TRUE                               0              NA</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>  <span class="at">a =</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;2025-01-11 19:23:46&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;UTC&quot;</span>),</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>  <span class="at">.prudence =</span> <span class="st">&quot;stingy&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">strftime</span>(a, <span class="st">&quot;%H:%M:%S&quot;</span>))</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co">#&gt; # A duckplyr data frame: 2 variables</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#&gt;   a                   `strftime(a, &quot;%H:%M:%S&quot;)`</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="co">#&gt;   &lt;dttm&gt;              &lt;chr&gt;                    </span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="co">#&gt; 1 2025-01-11 19:23:46 19:23:46</span></span></code></pre></div>
</div>
<div id="string-manipulation" class="section level3">
<h3>String manipulation</h3>
<p>Implemented: <code>grepl()</code>, <code>substr()</code>,
<code>sub()</code>, <code>gsub()</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(<span class="at">a =</span> <span class="st">&quot;abbc&quot;</span>, <span class="at">.prudence =</span> <span class="st">&quot;stingy&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">grepl</span>(<span class="st">&quot;b&quot;</span>, a), <span class="fu">substr</span>(a, <span class="dv">2</span><span class="dt">L</span>, <span class="dv">3</span><span class="dt">L</span>), <span class="fu">sub</span>(<span class="st">&quot;b&quot;</span>, <span class="st">&quot;B&quot;</span>, a), <span class="fu">gsub</span>(<span class="st">&quot;b&quot;</span>, <span class="st">&quot;B&quot;</span>, a))</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="co">#&gt; # A duckplyr data frame: 5 variables</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co">#&gt;   a     `grepl(&quot;b&quot;, a)` `substr(a, 2L, 3L)` `sub(&quot;b&quot;, &quot;B&quot;, a)`</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;lgl&gt;           &lt;chr&gt;               &lt;chr&gt;             </span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">#&gt; 1 abbc  TRUE            bbc                 aBbc              </span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt; # ℹ 1 more variable: `gsub(&quot;b&quot;, &quot;B&quot;, a)` &lt;chr&gt;</span></span></code></pre></div>
</div>
<div id="date-manipulation" class="section level3">
<h3>Date manipulation</h3>
<p>Implemented: <code>lubridate::hour()</code>,
<code>lubridate::minute()</code>, <code>lubridate::second()</code>,
<code>lubridate::wday()</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  <span class="at">a =</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;2025-01-11 19:23:46&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;UTC&quot;</span>),</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="at">.prudence =</span> <span class="st">&quot;stingy&quot;</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>    <span class="at">hour =</span> lubridate<span class="sc">::</span><span class="fu">hour</span>(a),</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>    <span class="at">minute =</span> lubridate<span class="sc">::</span><span class="fu">minute</span>(a),</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>    <span class="at">second =</span> lubridate<span class="sc">::</span><span class="fu">second</span>(a),</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>    <span class="at">wday =</span> lubridate<span class="sc">::</span><span class="fu">wday</span>(a)</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>  )</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="co">#&gt; # A duckplyr data frame: 5 variables</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co">#&gt;   a                    hour minute second  wday</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="co">#&gt;   &lt;dttm&gt;              &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="co">#&gt; 1 2025-01-11 19:23:46    19     23     46     7</span></span></code></pre></div>
</div>
<div id="aggregation" class="section level3">
<h3>Aggregation</h3>
<p>Implemented:</p>
<ul>
<li><code>sum(x, na.rm)</code>, <code>dplyr::n()</code>,
<code>dplyr::n_distinct()</code></li>
<li><code>mean(x, na.rm)</code>, <code>median(x, na.rm)</code>,
<code>sd(x, na.rm)</code></li>
<li><code>min()</code>, <code>max()</code>, <code>any()</code>,
<code>all()</code></li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(<span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">b =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>), <span class="at">.prudence =</span> <span class="st">&quot;stingy&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>    <span class="fu">sum</span>(a),</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>    <span class="fu">n</span>(),</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>    <span class="fu">n_distinct</span>(b),</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>  )</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co">#&gt; # A duckplyr data frame: 3 variables</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co">#&gt;   `sum(a)` `n()` `n_distinct(b)`</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co">#&gt;      &lt;dbl&gt; &lt;int&gt;           &lt;dbl&gt;</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co">#&gt; 1        6     3               2</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(<span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">b =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="cn">NA</span>), <span class="at">.prudence =</span> <span class="st">&quot;stingy&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a>    <span class="fu">mean</span>(b, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a>    <span class="fu">median</span>(a),</span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a>    <span class="fu">sd</span>(b),</span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a>  )</span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a><span class="co">#&gt; # A duckplyr data frame: 3 variables</span></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a><span class="co">#&gt;   `mean(b, na.rm = TRUE)` `median(a)` `sd(b)`</span></span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a><span class="co">#&gt;                     &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a><span class="co">#&gt; 1                     1.5           2      NA</span></span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(<span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">.prudence =</span> <span class="st">&quot;stingy&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb12-25"><a href="#cb12-25" tabindex="-1"></a>    <span class="fu">min</span>(a),</span>
<span id="cb12-26"><a href="#cb12-26" tabindex="-1"></a>    <span class="fu">max</span>(a),</span>
<span id="cb12-27"><a href="#cb12-27" tabindex="-1"></a>    <span class="fu">any</span>(a <span class="sc">&gt;</span> <span class="dv">1</span>),</span>
<span id="cb12-28"><a href="#cb12-28" tabindex="-1"></a>    <span class="fu">all</span>(a <span class="sc">&gt;</span> <span class="dv">1</span>),</span>
<span id="cb12-29"><a href="#cb12-29" tabindex="-1"></a>  )</span>
<span id="cb12-30"><a href="#cb12-30" tabindex="-1"></a><span class="co">#&gt; # A duckplyr data frame: 4 variables</span></span>
<span id="cb12-31"><a href="#cb12-31" tabindex="-1"></a><span class="co">#&gt;   `min(a)` `max(a)` `any(a &gt; 1)` `all(a &gt; 1)`</span></span>
<span id="cb12-32"><a href="#cb12-32" tabindex="-1"></a><span class="co">#&gt;      &lt;int&gt;    &lt;int&gt; &lt;lgl&gt;        &lt;lgl&gt;       </span></span>
<span id="cb12-33"><a href="#cb12-33" tabindex="-1"></a><span class="co">#&gt; 1        1        3 TRUE         FALSE</span></span></code></pre></div>
</div>
<div id="shifting" class="section level3">
<h3>Shifting</h3>
<p>All optional arguments to <code>dplyr::lag()</code> and
<code>dplyr::lead()</code> are supported.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(<span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">.prudence =</span> <span class="st">&quot;stingy&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">lag</span>(a), <span class="fu">lead</span>(a))</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co">#&gt; # A duckplyr data frame: 3 variables</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co">#&gt;       a `lag(a)` `lead(a)`</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;    &lt;int&gt;     &lt;int&gt;</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="co">#&gt; 1     1       NA         2</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co">#&gt; 2     2        1         3</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co">#&gt; 3     3        2        NA</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(<span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">.prudence =</span> <span class="st">&quot;stingy&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">lag</span>(a, <span class="dv">2</span>), <span class="fu">lead</span>(a, <span class="at">n =</span> <span class="dv">2</span>))</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="co">#&gt; # A duckplyr data frame: 3 variables</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a><span class="co">#&gt;       a `lag(a, 2)` `lead(a, n = 2)`</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;       &lt;int&gt;            &lt;int&gt;</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a><span class="co">#&gt; 1     1          NA                3</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a><span class="co">#&gt; 2     2          NA               NA</span></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a><span class="co">#&gt; 3     3           1               NA</span></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(<span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">.prudence =</span> <span class="st">&quot;stingy&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">lag</span>(a, <span class="at">default =</span> <span class="dv">0</span>), <span class="fu">lead</span>(a, <span class="at">default =</span> <span class="dv">4</span>))</span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a><span class="co">#&gt; # A duckplyr data frame: 3 variables</span></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a><span class="co">#&gt;       a `lag(a, default = 0)` `lead(a, default = 4)`</span></span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;                 &lt;int&gt;                  &lt;int&gt;</span></span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a><span class="co">#&gt; 1     1                     0                      2</span></span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a><span class="co">#&gt; 2     2                     1                      3</span></span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a><span class="co">#&gt; 3     3                     2                      4</span></span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(<span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">b =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>), <span class="at">.prudence =</span> <span class="st">&quot;stingy&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-26"><a href="#cb13-26" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">lag</span>(a, <span class="at">order_by =</span> b), <span class="fu">lead</span>(a, <span class="at">order_by =</span> b))</span>
<span id="cb13-27"><a href="#cb13-27" tabindex="-1"></a><span class="co">#&gt; # A duckplyr data frame: 4 variables</span></span>
<span id="cb13-28"><a href="#cb13-28" tabindex="-1"></a><span class="co">#&gt;       a     b `lag(a, order_by = b)` `lead(a, order_by = b)`</span></span>
<span id="cb13-29"><a href="#cb13-29" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;dbl&gt;                  &lt;int&gt;                   &lt;int&gt;</span></span>
<span id="cb13-30"><a href="#cb13-30" tabindex="-1"></a><span class="co">#&gt; 1     3     1                     NA                       1</span></span>
<span id="cb13-31"><a href="#cb13-31" tabindex="-1"></a><span class="co">#&gt; 2     1     2                      3                       2</span></span>
<span id="cb13-32"><a href="#cb13-32" tabindex="-1"></a><span class="co">#&gt; 3     2     3                      1                      NA</span></span></code></pre></div>
</div>
<div id="ranking" class="section level3">
<h3>Ranking</h3>
<p><a href="https://duckdb.org/docs/sql/functions/window_functions.html">Ranking
in DuckDB</a> is very different from dplyr. Most functions in DuckDB
rank only by the current row number, whereas in dplyr, ranking is done
by a column. It will be difficult to provide translations for the
following ranking functions.</p>
<ul>
<li><code>rank()</code>, <code>dplyr::min_rank()</code>,
<code>dplyr::dense_rank()</code></li>
<li><code>dplyr::percent_rank()</code>,
<code>dplyr::cume_dist()</code></li>
</ul>
<p>Implementing <code>dplyr::ntile()</code> is feasible for the
<code>n</code> argument. The only ranking function currently implemented
is <code>dplyr::row_number()</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(<span class="at">a =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="at">.prudence =</span> <span class="st">&quot;stingy&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">row_number</span>())</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="co">#&gt; # A duckplyr data frame: 2 variables</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co">#&gt;       a `row_number()`</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt;          &lt;int&gt;</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co">#&gt; 1     1              1</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co">#&gt; 2     2              2</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="co">#&gt; 3     2              3</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="co">#&gt; 4     3              4</span></span></code></pre></div>
</div>
<div id="special-cases" class="section level3">
<h3>Special cases</h3>
<p><code>$</code> (<code>?Extract</code>) is implemented if the LHS is
<code>.data</code> or <code>.env</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>, <span class="at">.prudence =</span> <span class="st">&quot;stingy&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>  <span class="fu">mutate</span>(.data<span class="sc">$</span>a <span class="sc">+</span> .data<span class="sc">$</span>b, .env<span class="sc">$</span>b)</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co">#&gt; # A duckplyr data frame: 4 variables</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="co">#&gt;       a     b `.data$a + .data$b` `.env$b`</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;               &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co">#&gt; 1     1     2                   3        4</span></span></code></pre></div>
<p><code>%in%</code> (<code>?match</code>) is implemented if the RHS is
a constant with up to 100 values:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(<span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">.prudence =</span> <span class="st">&quot;stingy&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>  <span class="fu">mutate</span>(a <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)) <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>  <span class="fu">collect</span>()</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 2</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co">#&gt;       a `a %in% c(1, 3)`</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;lgl&gt;           </span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="co">#&gt; 1     1 TRUE            </span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="co">#&gt; 2     2 FALSE           </span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="co">#&gt; 3     3 TRUE</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">last_rel</span>()</span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a><span class="co">#&gt; DuckDB Relation: </span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="co">#&gt; ---------------------</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="co">#&gt; --- Relation Tree ---</span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a><span class="co">#&gt; ---------------------</span></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a><span class="co">#&gt; Projection [a as a, ___coalesce(&quot;|&quot;(&quot;r_base::==&quot;(a, 1.0), &quot;r_base::==&quot;(a, 3.0)), false) as a %in% c(1, 3)]</span></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a><span class="co">#&gt;   r_dataframe_scan(0xdeadbeef)</span></span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a><span class="co">#&gt; ---------------------</span></span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a><span class="co">#&gt; -- Result Columns  --</span></span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a><span class="co">#&gt; ---------------------</span></span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a><span class="co">#&gt; - a (INTEGER)</span></span>
<span id="cb16-22"><a href="#cb16-22" tabindex="-1"></a><span class="co">#&gt; - a %in% c(1, 3) (BOOLEAN)</span></span></code></pre></div>
<p><code>dplyr::desc()</code> is only implemented in the context of
<code>dplyr::arrange()</code>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(<span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">.prudence =</span> <span class="st">&quot;stingy&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(a)) <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>  <span class="fu">explain</span>()</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="co">#&gt; ┌---------------------------┐</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="co">#&gt; │          ORDER_BY         │</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="co">#&gt; │    --------------------   │</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="co">#&gt; │      dataframe_42_42      │</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="co">#&gt; │      10491496.a DESC      │</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="co">#&gt; └-------------┬-------------┘</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="co">#&gt; ┌-------------┴-------------┐</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a><span class="co">#&gt; │     R_DATAFRAME_SCAN      │</span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a><span class="co">#&gt; │    --------------------   │</span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a><span class="co">#&gt; │      Text: data.frame     │</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a><span class="co">#&gt; │       Projections: a      │</span></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a><span class="co">#&gt; │                           │</span></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a><span class="co">#&gt; │          ~3 rows          │</span></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a><span class="co">#&gt; └---------------------------┘</span></span></code></pre></div>
<p><code>suppressWarnings()</code> is a no-op:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">.prudence =</span> <span class="st">&quot;stingy&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">suppressWarnings</span>(a <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="co">#&gt; # A duckplyr data frame: 2 variables</span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="co">#&gt;       a `suppressWarnings(a + 1)`</span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt;                     &lt;dbl&gt;</span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a><span class="co">#&gt; 1     1                         2</span></span></code></pre></div>
</div>
<div id="contributing" class="section level3">
<h3>Contributing</h3>
<p>Refer to <a href="https://duckplyr.tidyverse.org/CONTRIBUTING.html#new-translations-for-functions">our
contributing guide</a> to learn how to contribute new translations to
the package. Ideally, duckplyr will also support adding custom
translations for functions for the duration of the current R
session.</p>
</div>
</div>
<div id="known-incompatibilities" class="section level2">
<h2>Known incompatibilities</h2>
<p>This section tracks known incompatibilities between dplyr and
duckplyr. Changing these is likely to require substantial effort, and
might be best addressed by providing new functions with consistent
behavior in both dplyr and DuckDB.</p>
<div id="output-order-stability" class="section level3">
<h3>Output order stability</h3>
<p>DuckDB does not guarantee order stability for the output. For
performance reasons, duckplyr does not enable output order stability by
default.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">flights_df</span>() <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>  duckplyr<span class="sc">::</span><span class="fu">as_duckdb_tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>  <span class="fu">distinct</span>(day) <span class="sc">|&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">paste</span>(day, <span class="at">collapse =</span> <span class="st">&quot; &quot;</span>)) <span class="co"># fallback</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="co">#&gt; # A duckplyr data frame: 1 variable</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="co">#&gt;   `paste(day, collapse = &quot; &quot;)`                                                  </span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                                                                         </span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a><span class="co">#&gt; 1 5 9 11 14 15 16 17 22 26 30 31 3 4 6 12 20 23 24 2 10 18 28 29 1 7 8 13 19 21…</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">flights_df</span>() <span class="sc">|&gt;</span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>  <span class="fu">distinct</span>(day) <span class="sc">|&gt;</span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">paste</span>(day, <span class="at">collapse =</span> <span class="st">&quot; &quot;</span>))</span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a><span class="co">#&gt;   `paste(day, collapse = &quot; &quot;)`                                                  </span></span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                                                                         </span></span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a><span class="co">#&gt; 1 5 9 11 14 15 16 17 22 26 30 31 3 4 6 12 20 23 24 1 7 8 13 19 21 25 27 2 10 18…</span></span></code></pre></div>
<p>This can be changed globally with the
<code>DUCKPLYR_OUTPUT_ORDER</code> environment variable, see
<code>?config</code> for details. With this setting, the output order is
stable, but the plans are more complicated, and DuckDB needs to do more
work.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">flights_df</span>() <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>  duckplyr<span class="sc">::</span><span class="fu">as_duckdb_tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>  <span class="fu">distinct</span>(day) <span class="sc">|&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>  <span class="fu">explain</span>()</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a><span class="co">#&gt; ┌---------------------------┐</span></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a><span class="co">#&gt; │       HASH_GROUP_BY       │</span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a><span class="co">#&gt; │    --------------------   │</span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a><span class="co">#&gt; │         Groups: #0        │</span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a><span class="co">#&gt; │                           │</span></span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a><span class="co">#&gt; │       ~336,776 rows       │</span></span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a><span class="co">#&gt; └-------------┬-------------┘</span></span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a><span class="co">#&gt; ┌-------------┴-------------┐</span></span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a><span class="co">#&gt; │         PROJECTION        │</span></span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a><span class="co">#&gt; │    --------------------   │</span></span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a><span class="co">#&gt; │            day            │</span></span>
<span id="cb20-16"><a href="#cb20-16" tabindex="-1"></a><span class="co">#&gt; │                           │</span></span>
<span id="cb20-17"><a href="#cb20-17" tabindex="-1"></a><span class="co">#&gt; │       ~336,776 rows       │</span></span>
<span id="cb20-18"><a href="#cb20-18" tabindex="-1"></a><span class="co">#&gt; └-------------┬-------------┘</span></span>
<span id="cb20-19"><a href="#cb20-19" tabindex="-1"></a><span class="co">#&gt; ┌-------------┴-------------┐</span></span>
<span id="cb20-20"><a href="#cb20-20" tabindex="-1"></a><span class="co">#&gt; │     R_DATAFRAME_SCAN      │</span></span>
<span id="cb20-21"><a href="#cb20-21" tabindex="-1"></a><span class="co">#&gt; │    --------------------   │</span></span>
<span id="cb20-22"><a href="#cb20-22" tabindex="-1"></a><span class="co">#&gt; │      Text: data.frame     │</span></span>
<span id="cb20-23"><a href="#cb20-23" tabindex="-1"></a><span class="co">#&gt; │      Projections: day     │</span></span>
<span id="cb20-24"><a href="#cb20-24" tabindex="-1"></a><span class="co">#&gt; │                           │</span></span>
<span id="cb20-25"><a href="#cb20-25" tabindex="-1"></a><span class="co">#&gt; │       ~336,776 rows       │</span></span>
<span id="cb20-26"><a href="#cb20-26" tabindex="-1"></a><span class="co">#&gt; └---------------------------┘</span></span>
<span id="cb20-27"><a href="#cb20-27" tabindex="-1"></a></span>
<span id="cb20-28"><a href="#cb20-28" tabindex="-1"></a>withr<span class="sc">::</span><span class="fu">with_envvar</span>(</span>
<span id="cb20-29"><a href="#cb20-29" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">DUCKPLYR_OUTPUT_ORDER =</span> <span class="st">&quot;TRUE&quot;</span>),</span>
<span id="cb20-30"><a href="#cb20-30" tabindex="-1"></a>  duckplyr<span class="sc">::</span><span class="fu">flights_df</span>() <span class="sc">|&gt;</span></span>
<span id="cb20-31"><a href="#cb20-31" tabindex="-1"></a>    duckplyr<span class="sc">::</span><span class="fu">as_duckdb_tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb20-32"><a href="#cb20-32" tabindex="-1"></a>    <span class="fu">distinct</span>(day) <span class="sc">|&gt;</span></span>
<span id="cb20-33"><a href="#cb20-33" tabindex="-1"></a>    <span class="fu">explain</span>()</span>
<span id="cb20-34"><a href="#cb20-34" tabindex="-1"></a>)</span>
<span id="cb20-35"><a href="#cb20-35" tabindex="-1"></a><span class="co">#&gt; ┌---------------------------┐</span></span>
<span id="cb20-36"><a href="#cb20-36" tabindex="-1"></a><span class="co">#&gt; │          ORDER_BY         │</span></span>
<span id="cb20-37"><a href="#cb20-37" tabindex="-1"></a><span class="co">#&gt; │    --------------------   │</span></span>
<span id="cb20-38"><a href="#cb20-38" tabindex="-1"></a><span class="co">#&gt; │      dataframe_42_42      │</span></span>
<span id="cb20-39"><a href="#cb20-39" tabindex="-1"></a><span class="co">#&gt; │ 42.___row_number ASC │</span></span>
<span id="cb20-40"><a href="#cb20-40" tabindex="-1"></a><span class="co">#&gt; └-------------┬-------------┘</span></span>
<span id="cb20-41"><a href="#cb20-41" tabindex="-1"></a><span class="co">#&gt; ┌-------------┴-------------┐</span></span>
<span id="cb20-42"><a href="#cb20-42" tabindex="-1"></a><span class="co">#&gt; │         PROJECTION        │</span></span>
<span id="cb20-43"><a href="#cb20-43" tabindex="-1"></a><span class="co">#&gt; │    --------------------   │</span></span>
<span id="cb20-44"><a href="#cb20-44" tabindex="-1"></a><span class="co">#&gt; │             #0            │</span></span>
<span id="cb20-45"><a href="#cb20-45" tabindex="-1"></a><span class="co">#&gt; │             #1            │</span></span>
<span id="cb20-46"><a href="#cb20-46" tabindex="-1"></a><span class="co">#&gt; │                           │</span></span>
<span id="cb20-47"><a href="#cb20-47" tabindex="-1"></a><span class="co">#&gt; │        ~67,355 rows       │</span></span>
<span id="cb20-48"><a href="#cb20-48" tabindex="-1"></a><span class="co">#&gt; └-------------┬-------------┘</span></span>
<span id="cb20-49"><a href="#cb20-49" tabindex="-1"></a><span class="co">#&gt; ┌-------------┴-------------┐</span></span>
<span id="cb20-50"><a href="#cb20-50" tabindex="-1"></a><span class="co">#&gt; │           FILTER          │</span></span>
<span id="cb20-51"><a href="#cb20-51" tabindex="-1"></a><span class="co">#&gt; │    --------------------   │</span></span>
<span id="cb20-52"><a href="#cb20-52" tabindex="-1"></a><span class="co">#&gt; │   (___row_number_by = 1)  │</span></span>
<span id="cb20-53"><a href="#cb20-53" tabindex="-1"></a><span class="co">#&gt; │                           │</span></span>
<span id="cb20-54"><a href="#cb20-54" tabindex="-1"></a><span class="co">#&gt; │        ~67,355 rows       │</span></span>
<span id="cb20-55"><a href="#cb20-55" tabindex="-1"></a><span class="co">#&gt; └-------------┬-------------┘</span></span>
<span id="cb20-56"><a href="#cb20-56" tabindex="-1"></a><span class="co">#&gt; ┌-------------┴-------------┐</span></span>
<span id="cb20-57"><a href="#cb20-57" tabindex="-1"></a><span class="co">#&gt; │         PROJECTION        │</span></span>
<span id="cb20-58"><a href="#cb20-58" tabindex="-1"></a><span class="co">#&gt; │    --------------------   │</span></span>
<span id="cb20-59"><a href="#cb20-59" tabindex="-1"></a><span class="co">#&gt; │             #0            │</span></span>
<span id="cb20-60"><a href="#cb20-60" tabindex="-1"></a><span class="co">#&gt; │             #1            │</span></span>
<span id="cb20-61"><a href="#cb20-61" tabindex="-1"></a><span class="co">#&gt; │             #2            │</span></span>
<span id="cb20-62"><a href="#cb20-62" tabindex="-1"></a><span class="co">#&gt; │                           │</span></span>
<span id="cb20-63"><a href="#cb20-63" tabindex="-1"></a><span class="co">#&gt; │       ~336,776 rows       │</span></span>
<span id="cb20-64"><a href="#cb20-64" tabindex="-1"></a><span class="co">#&gt; └-------------┬-------------┘</span></span>
<span id="cb20-65"><a href="#cb20-65" tabindex="-1"></a><span class="co">#&gt; ┌-------------┴-------------┐</span></span>
<span id="cb20-66"><a href="#cb20-66" tabindex="-1"></a><span class="co">#&gt; │           WINDOW          │</span></span>
<span id="cb20-67"><a href="#cb20-67" tabindex="-1"></a><span class="co">#&gt; │    --------------------   │</span></span>
<span id="cb20-68"><a href="#cb20-68" tabindex="-1"></a><span class="co">#&gt; │        Projections:       │</span></span>
<span id="cb20-69"><a href="#cb20-69" tabindex="-1"></a><span class="co">#&gt; │     ROW_NUMBER() OVER     │</span></span>
<span id="cb20-70"><a href="#cb20-70" tabindex="-1"></a><span class="co">#&gt; │ (PARTITION BY day ORDER BY│</span></span>
<span id="cb20-71"><a href="#cb20-71" tabindex="-1"></a><span class="co">#&gt; │   ___row_number ASC NULLS │</span></span>
<span id="cb20-72"><a href="#cb20-72" tabindex="-1"></a><span class="co">#&gt; │            LAST)          │</span></span>
<span id="cb20-73"><a href="#cb20-73" tabindex="-1"></a><span class="co">#&gt; └-------------┬-------------┘</span></span>
<span id="cb20-74"><a href="#cb20-74" tabindex="-1"></a><span class="co">#&gt; ┌-------------┴-------------┐</span></span>
<span id="cb20-75"><a href="#cb20-75" tabindex="-1"></a><span class="co">#&gt; │         PROJECTION        │</span></span>
<span id="cb20-76"><a href="#cb20-76" tabindex="-1"></a><span class="co">#&gt; │    --------------------   │</span></span>
<span id="cb20-77"><a href="#cb20-77" tabindex="-1"></a><span class="co">#&gt; │             #0            │</span></span>
<span id="cb20-78"><a href="#cb20-78" tabindex="-1"></a><span class="co">#&gt; │             #1            │</span></span>
<span id="cb20-79"><a href="#cb20-79" tabindex="-1"></a><span class="co">#&gt; │                           │</span></span>
<span id="cb20-80"><a href="#cb20-80" tabindex="-1"></a><span class="co">#&gt; │       ~336,776 rows       │</span></span>
<span id="cb20-81"><a href="#cb20-81" tabindex="-1"></a><span class="co">#&gt; └-------------┬-------------┘</span></span>
<span id="cb20-82"><a href="#cb20-82" tabindex="-1"></a><span class="co">#&gt; ┌-------------┴-------------┐</span></span>
<span id="cb20-83"><a href="#cb20-83" tabindex="-1"></a><span class="co">#&gt; │      STREAMING_WINDOW     │</span></span>
<span id="cb20-84"><a href="#cb20-84" tabindex="-1"></a><span class="co">#&gt; │    --------------------   │</span></span>
<span id="cb20-85"><a href="#cb20-85" tabindex="-1"></a><span class="co">#&gt; │        Projections:       │</span></span>
<span id="cb20-86"><a href="#cb20-86" tabindex="-1"></a><span class="co">#&gt; │    ROW_NUMBER() OVER ()   │</span></span>
<span id="cb20-87"><a href="#cb20-87" tabindex="-1"></a><span class="co">#&gt; └-------------┬-------------┘</span></span>
<span id="cb20-88"><a href="#cb20-88" tabindex="-1"></a><span class="co">#&gt; ┌-------------┴-------------┐</span></span>
<span id="cb20-89"><a href="#cb20-89" tabindex="-1"></a><span class="co">#&gt; │     R_DATAFRAME_SCAN      │</span></span>
<span id="cb20-90"><a href="#cb20-90" tabindex="-1"></a><span class="co">#&gt; │    --------------------   │</span></span>
<span id="cb20-91"><a href="#cb20-91" tabindex="-1"></a><span class="co">#&gt; │      Text: data.frame     │</span></span>
<span id="cb20-92"><a href="#cb20-92" tabindex="-1"></a><span class="co">#&gt; │      Projections: day     │</span></span>
<span id="cb20-93"><a href="#cb20-93" tabindex="-1"></a><span class="co">#&gt; │                           │</span></span>
<span id="cb20-94"><a href="#cb20-94" tabindex="-1"></a><span class="co">#&gt; │       ~336,776 rows       │</span></span>
<span id="cb20-95"><a href="#cb20-95" tabindex="-1"></a><span class="co">#&gt; └---------------------------┘</span></span></code></pre></div>
</div>
<div id="sum" class="section level3">
<h3><code>sum()</code></h3>
<p>In duckplyr, this function returns a numeric value also for integers,
due to DuckDB’s type stability requirement.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(<span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">sum</span>(a))</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="co">#&gt; # A duckplyr data frame: 1 variable</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="co">#&gt;   `sum(a)`</span></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a><span class="co">#&gt;      &lt;dbl&gt;</span></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a><span class="co">#&gt; 1     5050</span></span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(<span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000000</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">sum</span>(a))</span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a><span class="co">#&gt; # A duckplyr data frame: 1 variable</span></span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a><span class="co">#&gt;       `sum(a)`</span></span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a><span class="co">#&gt;          &lt;dbl&gt;</span></span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a><span class="co">#&gt; 1 500000500000</span></span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">sum</span>(a))</span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb21-18"><a href="#cb21-18" tabindex="-1"></a><span class="co">#&gt;   `sum(a)`</span></span>
<span id="cb21-19"><a href="#cb21-19" tabindex="-1"></a><span class="co">#&gt;      &lt;dbl&gt;</span></span>
<span id="cb21-20"><a href="#cb21-20" tabindex="-1"></a><span class="co">#&gt; 1     5050</span></span>
<span id="cb21-21"><a href="#cb21-21" tabindex="-1"></a></span>
<span id="cb21-22"><a href="#cb21-22" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000000</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-23"><a href="#cb21-23" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">sum</span>(a))</span>
<span id="cb21-24"><a href="#cb21-24" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb21-25"><a href="#cb21-25" tabindex="-1"></a><span class="co">#&gt;       `sum(a)`</span></span>
<span id="cb21-26"><a href="#cb21-26" tabindex="-1"></a><span class="co">#&gt;          &lt;dbl&gt;</span></span>
<span id="cb21-27"><a href="#cb21-27" tabindex="-1"></a><span class="co">#&gt; 1 500000500000</span></span></code></pre></div>
</div>
<div id="empty-vectors-in-aggregate-functions" class="section level3">
<h3>Empty vectors in aggregate functions</h3>
<p>At the time of writing, empty vectors only occur when summarizing an
empty table without grouping. In all cases, duckplyr returns
<code>NA</code>, and the behavior of dplyr is different:</p>
<ul>
<li><code>sum()</code> for an empty vector returns <code>0</code></li>
<li><code>any()</code> and <code>all()</code> return
<code>FALSE</code></li>
<li><code>min()</code> and <code>max()</code> return infinity values
(with a warning)</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(<span class="at">a =</span> <span class="fu">integer</span>(), <span class="at">b =</span> <span class="fu">logical</span>()) <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">sum</span>(a), <span class="fu">any</span>(b), <span class="fu">all</span>(b), <span class="fu">min</span>(a), <span class="fu">max</span>(a))</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="co">#&gt; # A duckplyr data frame: 5 variables</span></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a><span class="co">#&gt;   `sum(a)` `any(b)` `all(b)` `min(a)` `max(a)`</span></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a><span class="co">#&gt;      &lt;dbl&gt; &lt;lgl&gt;    &lt;lgl&gt;       &lt;int&gt;    &lt;int&gt;</span></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a><span class="co">#&gt; 1       NA NA       NA             NA       NA</span></span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">a =</span> <span class="fu">integer</span>(), <span class="at">b =</span> <span class="fu">logical</span>()) <span class="sc">|&gt;</span></span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">sum</span>(a), <span class="fu">any</span>(b), <span class="fu">all</span>(b), <span class="fu">min</span>(a), <span class="fu">max</span>(a))</span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 5</span></span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a><span class="co">#&gt;   `sum(a)` `any(b)` `all(b)` `min(a)` `max(a)`</span></span>
<span id="cb22-11"><a href="#cb22-11" tabindex="-1"></a><span class="co">#&gt;      &lt;dbl&gt; &lt;lgl&gt;    &lt;lgl&gt;       &lt;int&gt;    &lt;int&gt;</span></span>
<span id="cb22-12"><a href="#cb22-12" tabindex="-1"></a><span class="co">#&gt; 1       NA NA       NA             NA       NA</span></span></code></pre></div>
</div>
<div id="min-and-max-for-logical-input" class="section level3">
<h3><code>min()</code> and <code>max()</code> for logical input</h3>
<p>For completeness, duckplyr returns a logical for <code>min()</code>
and <code>max()</code> when the input is logical, while dplyr returns an
integer.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(<span class="at">a =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">min</span>(a), <span class="fu">max</span>(a))</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a><span class="co">#&gt; # A duckplyr data frame: 2 variables</span></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a><span class="co">#&gt;   `min(a)` `max(a)`</span></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a><span class="co">#&gt;   &lt;lgl&gt;    &lt;lgl&gt;   </span></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a><span class="co">#&gt; 1 FALSE    TRUE</span></span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">a =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">min</span>(a), <span class="fu">max</span>(a))</span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 2</span></span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a><span class="co">#&gt;   `min(a)` `max(a)`</span></span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a><span class="co">#&gt;   &lt;lgl&gt;    &lt;lgl&gt;   </span></span>
<span id="cb23-13"><a href="#cb23-13" tabindex="-1"></a><span class="co">#&gt; 1 FALSE    TRUE</span></span></code></pre></div>
</div>
<div id="n_distinct-and-multiple-arguments" class="section level3">
<h3><code>n_distinct()</code> and multiple arguments</h3>
<p>This function needs exactly one argument besides the optional
<code>na.rm</code>. Multiple arguments is not supported.</p>
</div>
<div id="is.na-and-nan-values" class="section level3">
<h3><code>is.na()</code> and <code>NaN</code> values</h3>
<p>This function returns <code>FALSE</code> for <code>NaN</code> values
in duckplyr, while it returns <code>TRUE</code> in dplyr.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>duckplyr<span class="sc">::</span><span class="fu">duckdb_tibble</span>(<span class="at">a =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NaN</span>)) <span class="sc">|&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">is.na</span>(a))</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a><span class="co">#&gt; # A duckplyr data frame: 2 variables</span></span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a><span class="co">#&gt;       a `is.na(a)`</span></span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;lgl&gt;     </span></span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a><span class="co">#&gt; 1    NA TRUE      </span></span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a><span class="co">#&gt; 2   NaN FALSE</span></span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">a =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NaN</span>)) <span class="sc">|&gt;</span></span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">is.na</span>(a))</span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a><span class="co">#&gt;       a `is.na(a)`</span></span>
<span id="cb24-13"><a href="#cb24-13" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;lgl&gt;     </span></span>
<span id="cb24-14"><a href="#cb24-14" tabindex="-1"></a><span class="co">#&gt; 1    NA TRUE      </span></span>
<span id="cb24-15"><a href="#cb24-15" tabindex="-1"></a><span class="co">#&gt; 2   NaN FALSE</span></span></code></pre></div>
</div>
<div id="other-differences" class="section level3">
<h3>Other differences</h3>
<p>Does the same pipeline give different results with
<code>tibble()</code> and <code>duckdb_tibble()</code>? We would love to
hear about it, please file an <a href="https://github.com/tidyverse/duckplyr/issues/new">issue</a>.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
